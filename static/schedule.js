let selectedCourses=new Map,curriculumResults=[];const currentResult=document.getElementById("currentResult"),totalResult=document.getElementById("totalResults"),colors=["#eea2a4","#f0a1a8","#c45a65","#ef82a0","#d276a3","#d1c2d3","#93b5cf","#d8e3e7","#c6e6e8","#92b3a5","#b9dec9","#add5a2","#d2d97a","#f8df72","#f9d770","#ee8055"],TIME_SLOTS=["第一、二节 (8:00-9:50)","第三、四节 (10:20-12:10)","第五、六节 (14:00-15:50)","第七、八节 (16:20-18:10)","第九、十节 (19:00-20:50)"],WEEK_DAYS=["周一","周二","周三","周四","周五","周六","周日"],TIME_SLOTS_SHORT=["第一、二节","第三、四节","第五、六节","第七、八节","第九、十节"];function recolorCourseById(e){const t=document.querySelectorAll(`td[data-course-id="${e}"]`);if(!t.length)return;let n=t[0].dataset.bg||"",o=n;for(let e=0;e<8;e++){const e=colors[Math.random()*colors.length|0]+"55";if(e!==n){o=e;break}}t.forEach((e=>{e.style.backgroundColor=o,e.dataset.bg=o}))}function loadSelectedCourses(){const e=localStorage.getItem("selectedCourses");return e?new Map(JSON.parse(e)):(window.location.href="index.html",null)}function saveToLocalStorage(){const e=Array.from(selectedCourses.entries()).map((([e,t])=>[e,{...t}]));localStorage.setItem("selectedCourses",JSON.stringify(e))}function arrangeSchedule(e){function t(t){const n=t.id.charAt(t.id.length-1);if(n>="0"&&n<="9")return!1;const o=t.id.slice(0,-1);return e.has(o)}curriculumResults=[];const n=Object.create(null),o=[],r=Array.from(e.values());for(const d of r){if(!1===d?.active)continue;if(t(d)){o.push(d);continue}const u=d.kcmc;n[u]||(n[u]=[]);const m=[];for(const h of r)!1!==h?.active&&t(h)&&h.id.startsWith(d.id)&&m.push(h);if(m.length>0)for(const f of m)n[u].push([d,f]);else n[u].push([d])}const s=Object.keys(n);if(document.getElementById("selectedCounts").innerHTML=`已选课程(${s.length})`,0===s.length)return currentResult.innerHTML=0,void(totalResult.innerHTML=0);const c=new Map;r.forEach(((e,t)=>{!1!==e?.active&&(c.has(e.kcmc)||c.set(e.kcmc,t))})),s.sort(((e,t)=>(c.get(e)??0)-(c.get(t)??0))),s.forEach((e=>{n[e].sort(((e,t)=>e.reduce(((e,t)=>e+(t.time&&t.time.length||0)),0)-t.reduce(((e,t)=>e+(t.time&&t.time.length||0)),0)))}));const a=new Set,i=[];if(function e(t){if(t===s.length)return void curriculumResults.push(i.map((e=>e.slice())));const o=s[t],r=n[o];for(const n of r){let o=!0;for(const e of n){const t=e.time||[];for(const e of t)if(a.has(e)){o=!1;break}if(!o)break}if(o){i.push(n);for(const e of n){const t=e.time||[];for(const e of t)a.add(e)}e(t+1);for(const e of n){const t=e.time||[];for(const e of t)a.delete(e)}i.pop()}}}(0),0===curriculumResults.length){const g=256e4;for(let p=1;p<=s.length-1;p++){const v=[],y=new Set,S=[];function l(e,t){if(v.length>=g)return;if(e===s.length)return void(S.length>0&&(o=S,v.some((e=>isSameCombination(e,o)))||v.push(o.map((e=>e.slice())))));var o;const r=s[e],c=n[r];for(const n of c){let o=!0;for(const e of n){for(const t of e.time||[])if(y.has(t)){o=!1;break}if(!o)break}if(o){S.push(n);for(const e of n)for(const t of e.time||[])y.add(t);l(e+1,t);for(const e of n)for(const t of e.time||[])y.delete(t);if(S.pop(),v.length>=g)return}}t>0&&l(e+1,t-1)}if(l(0,p),v.length>0){curriculumResults=v;break}}}0===curriculumResults.length&&(currentResult.innerHTML=0,totalResult.innerHTML=0)}function isSameCombination(e,t){if(e.length!==t.length)return!1;const n=e=>{const t=new Set;return e.forEach((e=>{e.forEach((e=>{t.add(e.id)}))})),t},o=n(e),r=n(t);if(o.size!==r.size)return!1;for(let e of o)if(!r.has(e))return!1;return!0}function visited(e,t){for(let n=0;n<e.length;n++)if(e[n][0].kcmc===t)return!0;return!1}function valid(e,t){let n=[];for(let t=0;t<e.length;t++)for(let o=0;o<e[t].length;o++)n.push(...e[t][o].time);for(let e=0;e<t.length;e++)for(let o=0;o<t[e].time.length;o++)if(n.includes(t[e].time[o]))return!1;return!0}function dfs(e,t,n,o){let r=!1;for(lesson of t){if(visited(e,lesson))continue;let s=n[lesson];for(let c=0;c<s.length;c++)if(valid(e,s[c])){r=!0;let a=[];a.push(...e),a.push(s[c]),dfs(a,t,n,o)}}if(!r){o.some((t=>isSameCombination(t,e)))||o.push(e)}}function renderSchedule(e){const t=document.querySelectorAll("#oddWeek tbody tr"),n=document.querySelectorAll("#evenWeek tbody tr");if(document.querySelectorAll("td").forEach((e=>{e.classList.contains("time-cell")||(e.innerHTML="",e.style.backgroundColor="transparent",e.classList.remove("course-slot"),e.removeAttribute("data-course-id"),e.removeAttribute("data-bg"),e.removeAttribute("data-bghi"),e.oncontextmenu=t=>{t.preventDefault();const n="oddWeek"===e.closest("table").id,o=Array.from(e.parentNode.parentNode.children).indexOf(e.parentNode),r=Array.from(e.parentNode.children).indexOf(e);r>0&&showContextMenu(t,null,null,n,r,o)})})),0===curriculumResults.length){const e=document.getElementById("planCourseCount");return void(e&&(e.textContent="0"))}currentResult.innerHTML=e+1,totalResult.innerHTML=curriculumResults.length;const o=curriculumResults[e],r=document.getElementById("planCourseCount");r&&(r.textContent=String(o.length||0)),console.log("绘制课程表",e);for(let e=0;e<o.length;e++)for(let r=0;r<o[e].length;r++){const s=o[e][r];if(s){let e=colors[Math.random()*colors.length|0];for(let o=0;o<(s.time?.length||0);o++){const r=s.time[o],c="1"===r?.charAt(0),a=parseInt(r?.slice(1,2),10),i=0===a?7:a,l=parseInt(r?.slice(2,3),10),d=Math.floor((l-1)/2);if(!Number.isInteger(i)||i<1||i>7)continue;if(!Number.isInteger(d)||d<0||d>=t.length)continue;const u=c?t[d].getElementsByTagName("td"):n[d].getElementsByTagName("td");if(!u||i>=u.length)continue;const m=e+"55";u[i].innerHTML=`<div class="course-name">${s.kcmc}</div><div class="course-teacher">${s.dgjsmc}</div>`,u[i].style.backgroundColor=m,u[i].dataset.bg=m,u[i].classList.add("course-slot"),u[i].dataset.courseId=s.id,u[i].onclick=()=>recolorCourseById(s.id),u[i].oncontextmenu=e=>{e.preventDefault(),showContextMenu(e,s,r,c,i,d)}}}}}function showContextMenu(e,t,n,o,r,s){hideContextMenu();const c=document.createElement("div");c.className="context-menu",c.id="contextMenu";const a=`${o?"单":"双"}周${WEEK_DAYS[r-1]} ${TIME_SLOTS_SHORT[s]}`;let i="";i=t?`\n            <button class="context-menu-item" data-action="recolor" data-course-id="${t.id}">\n                <span class="icon">🎨</span>\n                更换课程颜色\n            </button>\n            <button class="context-menu-item" data-action="details" data-course-id="${t.id}">\n                <span class="icon">📋</span>\n                查看课程详情\n            </button>\n            <button class="context-menu-item" data-action="highlight" data-course-id="${t.id}">\n                <span class="icon">✨</span>\n                高亮同名课程\n            </button>\n            <button class="context-menu-item" data-action="clear-slot" data-time-code="${n}" data-is-odd="${o}" data-col="${r}" data-row="${s}">\n                <span class="icon">🧹</span>\n                清空该时段课程\n            </button>\n            <button class="context-menu-item danger" data-action="disable" data-course-id="${t.id}">\n                <span class="icon">🚫</span>\n                禁用此课程\n            </button>\n        `:`\n            <button class="context-menu-item" data-action="clear-slot" data-is-odd="${o}" data-col="${r}" data-row="${s}">\n                <span class="icon">🧹</span>\n                清空该时段课程\n            </button>\n        `,c.innerHTML=`\n        <div class="context-menu-header">${a}</div>\n        <div class="context-menu-divider"></div>\n        ${i}\n    `,c.style.visibility="hidden",c.style.display="block",document.body.appendChild(c);const l=c.getBoundingClientRect(),d=l.width,u=l.height,m=window.innerWidth,h=window.innerHeight,f=document.querySelector(".schedule-grid"),g=document.getElementById("scheduleGrid");let p={left:0,right:m,top:0,bottom:h};if(f&&g){const e=f.getBoundingClientRect(),t=g.getBoundingClientRect();p={left:Math.max(e.left,t.left,0),right:Math.min(e.right,t.right,m),top:Math.max(e.top,t.top,0),bottom:Math.min(e.bottom,t.bottom,h)}}let v=e.clientX,y=e.clientY;const S=10;v+d+S>p.right&&(v=Math.max(p.left+S,p.right-d-S),v+d+S>p.right&&(v=Math.max(p.left+S,e.clientX-d-S))),v<p.left+S&&(v=p.left+S),y+u+S>p.bottom&&(y=Math.max(p.top+S,p.bottom-u-S),y+u+S>p.bottom&&(y=Math.max(p.top+S,e.clientY-u-S))),y<p.top+S&&(y=p.top+S),v=Math.max(S,Math.min(v,m-d-S)),y=Math.max(S,Math.min(y,h-u-S)),d>m-20&&(v=S),u>h-20&&(y=S),c.style.left=`${v}px`,c.style.top=`${y}px`,c.style.visibility="visible",c.addEventListener("click",handleContextMenuClick),setTimeout((()=>{document.addEventListener("click",handleOutsideClick),document.addEventListener("contextmenu",handleOutsideClick),document.addEventListener("scroll",hideContextMenu),window.addEventListener("resize",hideContextMenu)}),0)}function handleContextMenuClick(e){e.stopPropagation();const t=e.target.closest(".context-menu-item");if(!t)return;const n=t.getAttribute("data-action"),o=t.getAttribute("data-course-id"),r=(t.getAttribute("data-time-code"),"true"===t.getAttribute("data-is-odd")),s=parseInt(t.getAttribute("data-col")),c=parseInt(t.getAttribute("data-row"));switch(n){case"recolor":recolorCourseById(o);break;case"details":viewCourseDetails(o);break;case"highlight":highlightSameCourse(o);break;case"clear-slot":clearTimeSlot(r,s,c);break;case"disable":disableCourseFromSchedule(o)}hideContextMenu()}function handleOutsideClick(e){const t=document.getElementById("contextMenu");t&&!t.contains(e.target)&&hideContextMenu()}function hideContextMenu(){const e=document.getElementById("contextMenu");e&&(e.removeEventListener("click",handleContextMenuClick),document.removeEventListener("click",handleOutsideClick),document.removeEventListener("contextmenu",handleOutsideClick),document.removeEventListener("scroll",hideContextMenu),window.removeEventListener("resize",hideContextMenu),e.remove())}function viewCourseDetails(e){const t=Array.from(selectedCourses.values()).find((t=>t.id===e));if(!t)return;let n="";t.time&&t.time.length>0&&(n=t.time.map((e=>{const t="1"===e.charAt(0),n=parseInt(e.slice(1,2),10),o=0===n?7:n,r=parseInt(e.slice(2,3),10),s=Math.floor((r-1)/2);return o<1||o>7||s<0||s>4?"":`${t?"单":"双"}周${WEEK_DAYS[o-1]} ${TIME_SLOTS_SHORT[s]}`})).filter((e=>e)).join("\n"));const o=`课程名称：${t.kcmc}\n教师：${t.dgjsmc}\n课程ID：${t.id}\n开课院系：${t.kkyxmc||"未知"}\n任务名称：${t.rwmc||""}\n\n上课时间：\n${n||"无时间安排"}`;alert(o),hideContextMenu()}function highlightSameCourse(e){Array.from(selectedCourses.values()).find((t=>t.id===e))&&(document.querySelectorAll(".course-slot").forEach((e=>{e.style.border="",e.style.outline=""})),document.querySelectorAll(`td[data-course-id="${e}"]`).forEach((e=>{e.style.border="3px solid #ff4444",e.style.outline="2px solid rgba(255, 68, 68, 0.3)"})),setTimeout((()=>{document.querySelectorAll(".course-slot").forEach((e=>{e.style.border="",e.style.outline=""}))}),3e3),hideContextMenu())}function disableCourseFromSchedule(e){const t=selectedCourses.get(e);t&&confirm(`确定要禁用课程"${t.kcmc}"吗？\n（禁用后可在已选课程列表中重新启用）`)&&(t.active=!1,saveToLocalStorage(),arrangeSchedule(selectedCourses),renderSchedule(0),updateSelectedList())}function clearTimeSlot(e,t,n){const o=`${e?"单":"双"}周${WEEK_DAYS[t-1]} ${TIME_SLOTS[n]}`;if(!confirm(`确定要禁用所有在"${o}"时段的课程吗？`))return;const r=e?"1":"2",s=7===t?"0":t.toString(),c=r+s+(2*n+1).toString(),a=r+s+(2*n+2).toString();let i=0;for(let[e,t]of selectedCourses)if(!1!==t.active&&t.time){t.time.some((e=>e===c||e===a||e.startsWith(c)||e.startsWith(a)))&&(t.active=!1,i++)}i>0?(saveToLocalStorage(),arrangeSchedule(selectedCourses),renderSchedule(0),updateSelectedList(),alert(`已禁用 ${i} 门在该时段的课程`)):alert("该时段没有找到活跃的课程")}function removeCourseFromSchedule(e){disableCourseFromSchedule(e)}function paging(e){let t=parseInt(currentResult.innerHTML),n=curriculumResults.length;if("prev"===e)1===t?t=n:t--;else if("next"===e)t===n?t=1:t++;else{if(1===t&&e<0||t===n&&e>0)return;t+=e,t<1&&(t=1),t>n&&(t=n)}renderSchedule(t-1)}function updateSelectedList(){document.querySelector(".selected-list").innerHTML=Array.from(selectedCourses.values()).map(((e,t)=>`\n        <div class="course-item" \n            draggable="true" \n            data-id="${e.id}"\n            data-priority="${t+1}">\n            <div class="drag-handle">⋮⋮</div>\n            <div class="course-info">\n                <div class="course-name">${e.kcmc}</div>\n                <div class="course-teacher">${e.dgjsmc}</div>\n                <div class="priority-label">优先级: ${t+1}</div>\n            </div>\n            <label class="toggle-switch">\n                <input type="checkbox" \n                    ${!1!==e.active?"checked":""} \n                    onchange="toggleCourse('${e.id}', this.checked)">\n                <span class="toggle-slider"></span>\n            </label>\n        </div>\n    `)).join(""),setupDragAndDrop()}function toggleCourse(e,t){const n=selectedCourses.get(e);n&&(n.active=t,saveToLocalStorage(),arrangeSchedule(selectedCourses),renderSchedule(0))}function setupDragAndDrop(){document.querySelectorAll(".selected-list .course-item").forEach((e=>{e.addEventListener("dragstart",handleDragStart),e.addEventListener("dragenter",handleDragEnter),e.addEventListener("dragleave",handleDragLeave),e.addEventListener("dragover",handleDragOver),e.addEventListener("drop",handleDrop)}))}function handleDragStart(e){e.target.closest(".selected-list")?(e.target.classList.add("dragging"),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",e.target.dataset.id)):e.preventDefault()}function handleDragEnter(e){e.preventDefault(),e.target.classList.contains("course-item")&&!e.target.classList.contains("dragging")&&e.target.classList.add("drag-over")}function handleDragLeave(e){e.preventDefault(),e.target.classList.contains("course-item")&&e.target.classList.remove("drag-over")}function handleDragOver(e){e.preventDefault(),e.dataTransfer.dropEffect="move";const t=document.querySelector(".dragging");if(!t)return;const n=document.querySelector(".selected-list"),o=[...n.querySelectorAll(".course-item:not(.dragging)")].find((t=>{const n=t.getBoundingClientRect();return e.clientY<n.top+n.height/2}));o?n.insertBefore(t,o):n.appendChild(t)}function handleDrop(e){e.preventDefault();document.querySelectorAll(".course-item").forEach((e=>{e.classList.remove("dragging","drag-over")})),updatePriorities()}function updatePriorities(){const e=document.querySelectorAll(".selected-list .course-item"),t=new Map;e.forEach(((e,n)=>{const o=e.dataset.id,r=selectedCourses.get(o);r&&(r.priority=n+1,t.set(o,r),e.querySelector(".priority-label").textContent=`优先级: ${n+1}`)})),selectedCourses=t,saveToLocalStorage(),arrangeSchedule(selectedCourses),renderSchedule(0)}function backToSelection(){window.location="/select.html"}async function saveAsImage(){if(0===curriculumResults.length)return void alert("没有可导出的课表！");const e=document.getElementById("scheduleGrid");if(!e)return void alert("找不到课表容器");const t=(window.getComputedStyle(document.body).fontFamily||"").trim(),n=document.createElement("div");n.style.position="fixed",n.style.left="-10000px",n.style.top="0",n.style.zIndex="-1";const o=document.createElement("style");o.textContent="\n      .schedule-export { background: var(--card-bg) !important; padding: 1rem; border-radius: 12px; }\n      .schedule-export > :first-child { background: var(--card-bg) !important; overflow: visible !important; }\n      .schedule-export table { height: auto !important; }\n      .schedule-export th, .schedule-export td { overflow: visible !important; white-space: normal !important; }\n      .schedule-export .course-name, .schedule-export .course-teacher {\n        white-space: normal !important;\n        overflow: visible !important;\n        text-overflow: clip !important;\n        word-break: break-word !important;\n        line-height: 1.2;\n      }\n      .schedule-export ::-webkit-scrollbar { display: none !important; }\n    ";const r=document.createElement("div");r.className="schedule-grid schedule-export";const s=document.createElement("div"),c=e.cloneNode(!0),a=Math.max(e.scrollWidth,e.getBoundingClientRect().width);s.style.width=a+"px",s.style.overflow="visible",t&&(r.style.fontFamily=t,s.style.fontFamily=t),s.appendChild(c),r.appendChild(s),n.appendChild(o),n.appendChild(r),document.body.appendChild(n),n.querySelectorAll("table").forEach((e=>{e.style.height="auto",e.style.maxHeight="none"}));try{const e=window.getComputedStyle(s).backgroundColor||"#ffffff",t=Math.max(1,Math.min(2,window.devicePixelRatio||1)),n=await window.modernScreenshot.domToPng(s,{backgroundColor:e,scale:t}),o=document.createElement("a");o.download=`课程表_方案${currentResult.innerHTML}.png`,o.href=n,o.click()}catch(e){console.error("导出图片时发生错误:",e),alert("导出图片失败，请稍后重试！")}finally{document.body.removeChild(n)}}function saveAsCSV(){if(0===curriculumResults.length)return void alert("没有可导出的数据！");const e=parseInt(currentResult.innerHTML)-1,t=curriculumResults[e],n=Array(5).fill().map((()=>Array(7).fill(""))),o=Array(5).fill().map((()=>Array(7).fill("")));t.forEach((e=>{e.forEach((e=>{e.time&&e.time.forEach((t=>{const r="1"===t.substring(0,1),s=parseInt(t.substring(1,2),10),c=0===s?6:s-1,a=Math.floor((parseInt(t.substring(2,3),10)-1)/2);if(c<0||c>6)return;if(a<0||a>4)return;const i=`${e.kcmc}\n${e.dgjsmc}`;r?n[a][c]=i:o[a][c]=i}))}))}));let r="\ufeff";r+="课程表数据导出\n",r+=`导出时间,${(new Date).toLocaleString("zh-CN")}\n`,r+=`方案编号,${e+1}/${curriculumResults.length}\n\n`,r+="单周课表\n",r+="时间,"+WEEK_DAYS.join(",")+"\n",TIME_SLOTS.forEach(((e,t)=>{const o=[e,...n[t].map((e=>e.replace(/\n/g," - ").replace(/,/g,"，")))];r+=o.join(",")+"\n"})),r+="\n",r+="双周课表\n",r+="时间,"+WEEK_DAYS.join(",")+"\n",TIME_SLOTS.forEach(((e,t)=>{const n=[e,...o[t].map((e=>e.replace(/\n/g," - ").replace(/,/g,"，")))];r+=n.join(",")+"\n"})),r+="\n",r+="课程详细信息\n",r+="课程名称,教师,课程ID,开课院系,时间安排\n";const s=new Map;t.forEach((e=>{e.forEach((e=>{if(!s.has(e.id)){const t=e.time?e.time.map((e=>{const t="1"===e.substring(0,1),n=parseInt(e.substring(1,2),10);return`${t?"单":"双"}周${WEEK_DAYS[0===n?6:n-1]}${TIME_SLOTS[Math.floor((parseInt(e.substring(2,3),10)-1)/2)]}`})).join("；"):"";s.set(e.id,{name:e.kcmc,teacher:e.dgjsmc,id:e.id,department:e.kkyxmc||"",time:t})}}))})),s.forEach((e=>{const t=[e.name.replace(/,/g,"，"),e.teacher.replace(/,/g,"，"),e.id,e.department.replace(/,/g,"，"),e.time.replace(/,/g,"，")];r+=t.join(",")+"\n"}));const c=new Blob([r],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a");a.download=`课程表数据_方案${e+1}_${(new Date).toISOString().slice(0,10)}.csv`,a.href=URL.createObjectURL(c),a.click(),URL.revokeObjectURL(a.href)}function buildShareText(){if(!curriculumResults||0===curriculumResults.length)return"";const e=Math.max(0,parseInt(currentResult.innerHTML)-1||0),t=curriculumResults[e]||[],n=new Map;t.forEach((e=>{e.forEach((e=>{e&&(n.has(e.id)||n.set(e.id,{name:e.kcmc,teacher:e.dgjsmc,times:[]}),(e.time||[]).forEach((e=>{const t="1"===e.substring(0,1),n=parseInt(e.substring(1,2),10),o=0===n?6:n-1,r=Math.floor((parseInt(e.substring(2,3),10)-1)/2);if(o<0||o>6)return;if(r<0||r>4)return;const s=`${t?"单":"双"}周${WEEK_DAYS[o]} ${TIME_SLOTS_SHORT[r]}`;target.times.includes(s)||target.times.push(s)})))}))}));const o=`SUSTech 自动排课 | 方案 ${e+1}/${curriculumResults.length} | 课程数 ${t.length}`,r=[];n.forEach((e=>{const t=e.times.join("；");r.push(`- ${e.name}（${e.teacher}）| ${t}`)}));const s="由“SUSTech 自动排课”生成，点击获取你的排课方案。打开电脑浏览器访问 "+window.location.origin;return[o,...r,s].join("\n")}async function copyToClipboard(e){try{if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(e);else{const t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.left="-9999px",document.body.appendChild(t),t.focus(),t.select(),document.execCommand("copy"),document.body.removeChild(t)}return!0}catch(e){return console.error("复制到剪贴板失败:",e),!1}}async function sharePlan(){if(!curriculumResults||0===curriculumResults.length)return void alert("暂无可分享的方案");const e=buildShareText();await copyToClipboard(e)?alert("已复制分享文案"):alert("复制失败，请手动复制")}document.addEventListener("DOMContentLoaded",(()=>{const e=loadSelectedCourses();e&&(selectedCourses=e,arrangeSchedule(selectedCourses),renderSchedule(0),updateSelectedList())})),document.getElementById("prevWeek").addEventListener("click",(()=>paging("prev"))),document.getElementById("nextWeek").addEventListener("click",(()=>paging("next"))),document.addEventListener("keydown",(e=>{let t=Math.round(curriculumResults.length/10);"ArrowLeft"===e.key||"h"===e.key?paging(e.shiftKey?-t:"prev"):"ArrowRight"!==e.key&&"l"!==e.key||paging(e.shiftKey?t:"next"),"Backspace"===e.key&&backToSelection(),console.log(e.key)})),document.getElementById("saveAsImage").addEventListener("click",saveAsImage),document.getElementById("saveAsJson").addEventListener("click",saveAsCSV),document.getElementById("sharePlan").addEventListener("click",sharePlan),rmEarlyEightBTN=document.getElementById("filter_1"),rmEarlyEightBTN.onclick=()=>{for(let[e,t]of selectedCourses)t.time&&t.time.some((e=>e.endsWith("12")))&&(t.active=!1);saveToLocalStorage(),arrangeSchedule(selectedCourses),renderSchedule(0),updateSelectedList()},rmLateClassBTN=document.getElementById("filter_2"),rmLateClassBTN.onclick=()=>{for(let[e,t]of selectedCourses)t.time&&t.time.some((e=>e.endsWith("910")))&&(t.active=!1);saveToLocalStorage(),arrangeSchedule(selectedCourses),renderSchedule(0),updateSelectedList()},resetBTN=document.getElementById("reset"),resetBTN.onclick=()=>{for(let[e,t]of selectedCourses)t.active=!0;saveToLocalStorage(),arrangeSchedule(selectedCourses),renderSchedule(0),updateSelectedList()};